import{_ as s,v as a,b as e,R as n}from"./chunks/framework.70afa331.js";const y=JSON.parse('{"title":"incus Installation Guide","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"en/guide/incus/incus_install.md","filePath":"en/guide/incus/incus_install.md","lastUpdated":1705326603000}'),t={name:"en/guide/incus/incus_install.md"},o=n(`<h1 id="incus-installation-guide" tabindex="-1">incus Installation Guide <a class="header-anchor" href="#incus-installation-guide" aria-label="Permalink to &quot;incus Installation Guide&quot;">​</a></h1><p>If your host does not have an IPV6 subnet and you want to assign IPV6 addresses to containers, then please check the <code>Customize</code> partition in the <code>incus</code> module for the <code>Attach a free IPV6 address segment</code> to the host, and attach an IPV6 subnet to the host before installing the environment.</p><h2 id="one-click-installation" tabindex="-1">One-Click Installation <a class="header-anchor" href="#one-click-installation" aria-label="Permalink to &quot;One-Click Installation&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>If this is a new server, make sure that both &#39;apt update&#39; and &#39;apt install curl&#39; are working properly before executing this script.</p></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>It&#39;s recommended to wait for at least 5 minutes after the system boots up before executing the following commands. This is to avoid the script being executed by the default system settings, which could cause issues with apt sources.</p></div><ul><li>Prerequisites: Ubuntu 18+ (recommended), Debian 8+ (x86_64 architecture only)</li></ul><p><strong>If you are on a Debian-based host, be sure to execute this script within a &#39;screen&#39; session to prevent ZFS compilation installation failure due to SSH interruptions during long-term runs.</strong></p><p>The virtual memory mentioned here refers to the desired SWAP size, and the storage pool represents the total size of all disks allocated for your virtual machines.</p><p>During the environment installation process, <strong>you might need to restart the server to load the kernel with ZFS support and then execute the installation command again. Follow the prompts in the command line after running for accurate instructions.</strong></p><p>Enable the lxcfs-related configuration of incus by default, so that in-container querying of container information changes to information about the container itself rather than the host.</p><p>If the script prompts you to restart the system and execute the script again, and if the second execution still requires a system restart to load the kernel, it means the kernel loading failed during the previous attempt. It&#39;s recommended to reinstall the host system using an Ubuntu-based version to resolve this issue.</p><p>Each time you run the script, you&#39;ll need to input the initialization configuration. So, if the script prompts you to restart the system and execute again, you&#39;ll need to input the initialization configuration again.</p><p>Command:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://raw.githubusercontent.com/oneclickvirt/incus/main/scripts/incus_install.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">incus_install.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">incus_install.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">bash</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">incus_install.sh</span></span></code></pre></div><p>Example of initialization configuration:</p><p>If there is 18GB of unused disk space on the system disk, after deducting the space already occupied, and you want to allocate 2GB of virtual memory (2048MB of SWAP) and a 15GB storage pool, then following the prompts in the command line, enter <code>2048</code> and <code>15</code>.</p><h2 id="manual-installation" tabindex="-1">Manual Installation <a class="header-anchor" href="#manual-installation" aria-label="Permalink to &quot;Manual Installation&quot;">​</a></h2><p>Recommended for beginners to avoid potential troubleshooting. However, if you&#39;re experienced and comfortable with debugging bugs, you can also use the later one-click installation method for convenience.</p><h3 id="disable-firewall" tabindex="-1">Disable Firewall <a class="header-anchor" href="#disable-firewall" aria-label="Permalink to &quot;Disable Firewall&quot;">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">apt</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">update</span></span>
<span class="line"><span style="color:#FFCB6B;">apt</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">wget</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dos2unix</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ufw</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">jq</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span></span>
<span class="line"><span style="color:#FFCB6B;">ufw</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">disable</span></span></code></pre></div><h3 id="enabling-virtual-memory-swap" tabindex="-1">Enabling Virtual Memory SWAP <a class="header-anchor" href="#enabling-virtual-memory-swap" aria-label="Permalink to &quot;Enabling Virtual Memory SWAP&quot;">​</a></h3><p>The amount of memory depends on how many instances you want to run. If you want to run 8 instances and calculate, you&#39;ll need 2GB of memory. If your actual physical memory is 512MB, you&#39;ll need an additional 1.5GB. To be cautious, allocate 2GB of virtual memory.</p><p>Execute the following commands: Enter &#39;1&#39;, then enter &#39;2048&#39;. This signifies allocating 2GB of virtual memory.</p><p>Command:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://raw.githubusercontent.com/oneclickvirt/incus/main/scripts/swap.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">swap.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">swap.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">bash</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">swap.sh</span></span></code></pre></div><h3 id="installing-incus" tabindex="-1">Installing incus <a class="header-anchor" href="#installing-incus" aria-label="Permalink to &quot;Installing incus&quot;">​</a></h3><p>Actually, the virtual memory allocated for swap should be twice the size of the actual memory. So, it&#39;s reasonable to allocate 1GB if the actual memory is 500MB. The scenario I described above is an excessive allocation.</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">apt install snapd -y</span></span>
<span class="line"><span style="color:#A6ACCD;">snap install incus</span></span>
<span class="line"><span style="color:#A6ACCD;">incus init</span></span></code></pre></div><p>If the following error occurs in the above command</p><p>(snap &quot;incus&quot; assumes unsupported features: snapd2.39 (try to update snapd and refresh the core snap))</p><p>Use the command patch before installing incus</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">snap install core</span></span></code></pre></div><p>If there are no exceptions, the results of the above three lines of commands are as follows</p><p><img src="https://user-images.githubusercontent.com/103393591/233270028-5a43d0f7-45f5-4175-969e-d4d182cb877a.png" alt="图片"></p><p>Just enter the default for the normal options</p><p>Choose the size of the physical disk (hint: select the default option with a minimum of 1GB). Generally, I fill in the available disk space minus the memory size, then multiply by 0.95 and round down. Here, I entered 10GB.</p><p>Remember to select &#39;no&#39; for options containing &#39;auto&#39; when prompted to update the image, in order to avoid occupying the system.</p>`,37),l=[o];function i(p,r,c,u,d,h){return a(),e("div",null,l)}const C=s(t,[["render",i]]);export{y as __pageData,C as default};
